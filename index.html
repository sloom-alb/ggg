async function fetchData() {
  try {
    const response = await fetch('https://script.google.com/macros/s/AKfycbw26BtKWUD6ZUV8DtGNQcvUo_oJoocBgevRqpXRV5boqaqJNtrLp8mWukOJK6xWtIY96A/exec');
    if (!response.ok) {
      throw new Error('خطأ في جلب البيانات من السيرفر: ' + response.status + ' - ' + response.statusText);
    }
    const data = await response.json();
    
    // تحقق من شكل البيانات المستلمة
    console.log("البيانات المستلمة:", data);
    
    const tableHead = document.getElementById('table-head');
    const tableBody = document.getElementById('data');
    const rowDropdown = document.getElementById('row-dropdown');
    const columnDropdown = document.getElementById('column-dropdown');
    
    if (Array.isArray(data) && data.length > 0) {
      // تعيين الصف الأول كعناوين للأعمدة
      const headerRow = document.createElement('tr');
      Object.keys(data[0]).forEach(key => {
        const th = document.createElement('th');
        th.textContent = key; // استخدام أسماء المفاتيح كعناوين
        headerRow.appendChild(th);
      });
      tableHead.appendChild(headerRow);

      // تعبئة الجدول ببقية الصفوف بدءًا من الصف الأول
      data.forEach(item => {
        const row = document.createElement('tr');
        Object.values(item).forEach(value => {
          const cell = document.createElement('td');
          cell.textContent = value || '';
          row.appendChild(cell);
        });
        tableBody.appendChild(row);
      });

      // تعبئة القوائم المنسدلة بالقيم الفريدة
      const column1 = Object.keys(data[0])[0]; // أخذ اسم العمود الأول
      const column2 = Object.keys(data[0])[1]; // أخذ اسم العمود الثاني

      populateDropdown(rowDropdown, data.map(item => item[column1]).filter(unique));
      populateDropdown(columnDropdown, data.map(item => item[column2]).filter(unique));

      // تصفية البيانات عند تغيير القيم في القوائم المنسدلة
      rowDropdown.addEventListener('change', () => filterTable(data));
      columnDropdown.addEventListener('change', () => filterTable(data));
    } else {
      console.error('البيانات غير كافية أو التنسيق غير صحيح.');
      tableBody.innerHTML = 'البيانات ليست في التنسيق المتوقع.';
    }
  } catch (error) {
    console.error('حدث خطأ أثناء جلب البيانات:', error);
    document.getElementById('data').innerHTML = 'حدث خطأ أثناء جلب البيانات: ' + error.message;
  }
}
